# DNF Party 개발 TODO 리스트

## 📅 2025-08-22 작업 계획

### 🔧 긴급 수정사항
- [x] **레이드 명칭 수정**: "이내 환혼전" → "이내 황혼전"으로 변경 (타임라인에서 잘못 표시되는 문제)
- [x] **타임라인 계산 오류 수정**: end 시간이 이상하게 들어가는 문제 해결 (현재시간 기준 KST)
- [ ] **햄스터블레님 전투력 크롤링**: 전투력 정보를 제대로 가져오지 못하는 문제 해결
- [ ] **케릭터 검색 페이지 숙제**: 환혼전이 안나오는 문제 해결
- [ ] **버퍼 크롤링 테스트**: 버퍼 직업 크롤링이 정상적으로 작동하는지 확인
- [ ] **인챈트리스 크롤링 테스트**: 인챈트리스 크롤링이 정상적으로 작동하는지 테스트
- [ ] **파티 짜주는 기능 테스트**: 파티 구성 알고리즘이 정상적으로 작동하는지 테스트

### 🆕 새로 발견된 문제점
- [ ] **SSE 전송 에러 해결**: Jackson JSR310 모듈 누락으로 인한 LocalDateTime 직렬화 실패
- [ ] **숙제 목록에 이내 황혼전 추가**: 캐릭터 검색 페이지의 숙제 섹션에 "이내 황혼전" 표시
- [ ] **크롤링 성능 최적화**: 총딜 추출에 7초 이상 소요되는 문제 개선

### 📝 세부 작업 내용
1. **레이드 명칭 수정**: 타임라인에서 "이내 환혼전"으로 잘못 표시되는 것을 "이내 황혼전"으로 수정 ✅
2. **타임라인 계산 로직 수정**: end 시간 계산 시 현재시간(KST)을 기준으로 정확하게 계산되도록 수정 ✅
3. **햄스터블레님 크롤링**: 전투력 정보 크롤링 로직 점검 및 수정
4. **케릭터 검색 페이지 숙제**: "이내 황혼전" 숙제 항목이 표시되지 않는 문제 해결
5. **버퍼/인챈트리스 크롤링**: 두 직업군의 크롤링이 정상 작동하는지 확인
6. **파티 구성 테스트**: 파티 짜주는 알고리즘의 정상 작동 여부 테스트
7. **SSE 에러 해결**: Jackson JSR310 모듈 추가로 LocalDateTime 직렬화 문제 해결
8. **크롤링 성능 개선**: 총딜 추출 시간을 7초에서 1-3초로 단축

### 🔍 로그 분석 결과
- **총딜 추출 시간**: 7초 (01:14:49 → 01:14:56) - 비정상적으로 오래 걸림
- **SSE 에러**: `Java 8 date/time type LocalDateTime not supported` - Jackson JSR310 모듈 필요
- **숙제 표시 문제**: "이내 황혼전"이 숙제 목록에 포함되지 않음

## 🎯 파티 구성 기능 개선 작업 (2025-08-22)

### 0. 명성컷 적용 상태 확인 및 검증
- [ ] **백엔드 명성컷 적용 확인**: 베누스(41,929), 안개신(30,135), 나벨(47,684), 황혼전(72,688) 최소 명성이 제대로 적용되었는지 확인
- [ ] **프론트엔드 명성 부족 표시 검증**: 
  - 케릭터 검색 시 "남은 숙제" 섹션에서 명성 부족으로 출력되는지 확인
  - 던전 클리어 현황에서 명성 부족으로 출력되는지 확인

### 1. 파티별 모험단 중복 방지 기능 구현
- [ ] **드래그 앤 드롭 중복 체크**: 각 파티에 캐릭터를 드래그하여 추가할 때, 해당 파티에 이미 같은 모험단 소속의 캐릭터가 있다면 추가되지 않도록 하는 기능 구현
- [ ] **사용자 피드백**: 중복 시도 시 적절한 메시지나 시각적 피드백 제공

### 2. 파티 구성 옵션 UI 구현
- [ ] **옵션 선택 영역 생성**: 기존 파티 구성 규칙 상자와 유사한 흰색 상자를 생성하여 옵션 선택 기능 제공
- [ ] **드롭다운 메뉴 구현**: 
  - `basic` (기본값)
  - `우선 빼기` 
  - `평균 최적화`
- [ ] **기본값 설정**: `basic`이 기본으로 선택되도록 설정

### 3. 자동 파티 생성 기능 구현 (Basic 방식)
- [ ] **캐릭터 리스트 생성**: 
  - **딜러 리스트**: 전투력 기준 내림차순 정렬 (강한 순)
  - **버퍼 리스트**: 버프력 기준 내림차순 정렬 (강한 순)
- [ ] **파티 구성 알고리즘**:
  - **딜러 추가 (1)**: 딜러 리스트에서 가장 강한 딜러 1명을 파티에 추가
  - **딜러 추가 (2, 3)**: 딜러 리스트의 반대 방향(약한 순)에서 캐릭터를 하나씩 뽑아 모험단 중복 체크
    - 같은 모험단이 파티에 없으면 추가
    - 같은 모험단이 이미 있으면 다음 캐릭터를 체크
    - 딜러 3명이 될 때까지 반복
  - **버퍼 추가 (1)**: 버퍼 리스트에서 역순(약한 순)으로 캐릭터를 하나씩 뽑아 모험단 중복 체크
    - 같은 모험단이 파티에 없으면 추가
    - 같은 모험단이 이미 있으면 다음 버퍼를 체크
    - 버퍼 1명이 될 때까지 반복
- [ ] **반복 파티 구성**: 딜러, 버퍼 리스트에서 최대한 뽑아낼 수 있을 때까지 위 과정을 반복하여 여러 파티 구성
- [ ] **결과 표시**: 구성된 파티들을 화면에 표시

### 4. 향후 구현 예정 기능
- [ ] **우선 빼기**: 특정 조건에 따라 우선적으로 제외할 캐릭터를 설정하는 기능
- [ ] **평균 최적화**: 파티 간 전투력/버프력 평균을 최적화하는 알고리즘

### 📋 구현 우선순위
1. **명성컷 적용 상태 확인** (검증 단계)
2. **모험단 중복 방지 기능** (기본 기능)
3. **파티 구성 옵션 UI** (사용자 인터페이스)
4. **Basic 자동 파티 생성** (핵심 알고리즘)
5. **추가 최적화 기능** (향후 확장)

## 🚀 파티 구성 페이지 추가 기능 요구사항 (2025-08-22)

### 1. 모험단 변경 시 파티 자동 초기화
- [x] **모험단 추가/제거 시 파티 초기화**: 선택된 모험단이 바뀔 때마다 `clearParty()` 메소드를 호출하여 기존 파티 구성을 초기화
- [x] **구현 방법**: `addAdventure` 함수와 `removeAdventure` 함수에 `clearParty()` 호출 추가
- [x] **사용자 경험**: 모험단 변경 시 기존 파티 구성이 자동으로 초기화되어 혼란 방지

### 2. 귓속말용 파티 복사 기능
- [x] **현 파티구성 최적화 → 귓속말용 파티 복사**: 버튼 이름을 "현 파티구성 최적화"에서 "귓속말용 파티 복사"로 변경
- [x] **이모지 통일**: 클립보드 복사와 동일한 📋 이모지 사용
- [x] **간소화된 파티 정보 복사**: 
  - 딜러: 억 단위로 변환 (예: 9,650,000,000 → 96.5)
  - 버퍼: 만 단위로 변환 (예: 4,120,000 → 412)
  - 출력 형식: "96.5, 33.2, 34.1, 412"
- [x] **클립보드 복사 유지**: 기존의 상세한 클립보드 복사 기능은 그대로 유지

### 3. 파티 구성 옵션 이름 변경
- [x] **우선 빼기 → 우선 순위 방식(개발중)**: 드롭다운 옵션명 변경
- [x] **평균 최적화 → 아이디어 추천좀(개발중)**: 드롭다운 옵션명 변경
- [x] **개발 상태 표시**: 향후 구현 예정인 기능임을 명확히 표시

### 4. 사용 가능한 캐릭터 정렬 개선
- [x] **딜러 정렬**: 전투력 기준 내림차순 정렬 (강한 순)
- [x] **버퍼 정렬**: 버프력 기준 내림차순 정렬 (강한 순)
- [x] **모험단별 표시**: 각 모험단 내에서 강한 딜러와 강한 버퍼가 맨 위에 표시
- [x] **사용자 경험**: 파티 구성 시 강한 캐릭터를 쉽게 찾을 수 있도록 개선

### 5. 자동 파티 생성 실패 알림
- [x] **Alert 창 표시**: 한 파티도 구성하지 못했을 때 브라우저 기본 Alert 창 표시
- [x] **실패 원인 분석**: 
  - 딜러 부족: "사용 가능한 딜러가 없습니다."
  - 버퍼 부족: "사용 가능한 버퍼가 없습니다."
  - 모험단 중복: "모험단 중복으로 인해 파티를 구성할 수 없습니다."
- [x] **사용자 안내**: 실패 원인을 명확하게 제시하여 문제 해결 방향 제시

### 6. 던전 선택 시 파티 초기화
- [x] **던전 버튼 클릭 시 파티 초기화**: 
  - 나벨 일반, 나벨 하드, 베누스, 안개신, 이내 황혼전 버튼 클릭 시
  - `clearParty()` 메소드 호출로 기존 파티 구성 초기화
- [x] **구현 방법**: `setDungeon` 함수에 `clearParty()` 호출 추가
- [x] **사용자 경험**: 던전 변경 시 이전 파티 구성이 자동으로 초기화되어 혼란 방지

### 7. 모험단 최신화 기능 구현
- [x] **모험단별 전체 최신화**: 모험단 최신화 버튼 클릭 시 2페이지의 "전체 최신화(던담 동기화 포함)" 기능을 모험단별로 실행
- [x] **순차 처리**: 선택된 모험단들을 하나씩 순차적으로 처리
- [x] **실패 시 다음 모험단 계속 진행**: 
  - 30초 타임아웃 등으로 한 모험단에서 실패가 발생해도
  - 다음 모험단 처리를 계속 진행
  - 전체 프로세스가 중단되지 않도록 구현
- [x] **결과 추적**: 각 모험단별 성공/실패 결과를 개별적으로 추적하고 로깅

### 8. 수동 파티 구성 검증 로직 구현
- [x] **모험단 중복 체크**: 파티에 같은 모험단 캐릭터 추가 시 차단
- [x] **역할 체크**: 버퍼 칸에는 버퍼만, 딜러 칸에는 딜러만 추가 가능
- [x] **에러 메시지**: 모험단 중복 및 역할 불일치 시 명확한 안내 메시지 표시

## 🚀 **자동 파티 생성 방식 고도화 요구사항 (2025-08-22)**

### 1. 자동 파티 생성 방식 확장
- [x] **기본 방식**: `Basic (기본)` - 현재 구현된 기본 파티 구성 알고리즘
- [x] **고급 방식**: `Advanced (고급)` - 새로운 고급 파티 구성 옵션 추가
- [x] **UI 변경**: 드롭다운 메뉴를 2단계 구조로 변경 (방식 선택 → 세부 옵션)

### 2. Advanced 모드 알고리즘 옵션
- [x] **알고리즘 체크박스 그룹**: 
  - **버퍼 우선**: 버퍼를 먼저 선택하고 파티 구성
  - **딜러 우선**: 딜러를 먼저 선택하고 파티 구성  
  - **모험단 우선**: 모험단 다양성을 최우선으로 고려하여 파티 구성
- [x] **다중 선택 가능**: 여러 알고리즘을 동시에 선택하여 복합적인 파티 구성
- [ ] **우선순위 설정**: 선택된 알고리즘들의 우선순위를 설정할 수 있는 기능

### 3. 기능 제한 해제 옵션
- [x] **버퍼-딜러 칸 무시**: 
  - 체크 시: 슬롯 1번에 딜러, 슬롯 2-4번에 버퍼 배치 가능
  - 기존 제한: 슬롯 1번=버퍼, 슬롯 2-4번=딜러만 허용
- [x] **딜러-버퍼 최소 인원 제한 해제**:
  - 체크 시: 파티 구성 시 1딜러+1버퍼 최소 조건 무시
  - 기존 제한: 최소 1딜러+1버퍼가 있어야 파티 구성
- [x] **유연한 파티 구성**: 제한 해제 시 다양한 조합의 파티 구성 가능

### 4. UI/UX 개선
- [x] **계층적 옵션 구조**: 
  ```
  자동 파티 생성 방식:
  ├── Basic (기본) - 현재 구현된 방식
  └── Advanced (고급)
      ├── 알고리즘:
      │   ├── ☐ 버퍼 우선   ☐ 딜러 우선  ☐ 모험단 우선
      └── 기능 제한 해제:
          ├── ☐ 버퍼-딜러 칸 무시  ☐ 딜러-버퍼 최소 인원 제한 해제
  ```
- [x] **동적 UI**: Advanced 선택 시에만 하위 옵션들이 표시
- [x] **설정 저장**: 사용자가 선택한 Advanced 옵션들을 로컬스토리지에 저장

### 5. 구현 우선순위
1. [x] **UI 구조 변경**: Basic/Advanced 선택 드롭다운
2. [x] **Advanced 옵션 UI**: 알고리즘 및 기능 제한 해제 체크박스
3. [x] **Advanced 파티 생성 로직**: 선택된 옵션에 따른 파티 구성 알고리즘 (기본 구조)
4. [x] **설정 저장/복원**: 사용자 선택 옵션 영속화

## 🚀 **파티 구성 페이지 반응형 UI/UX 개선 요구사항 (2025-08-22)**

### 1. 전역 네비게이션 메뉴 레이아웃 개선
- [ ] **현재 상태**: 메뉴가 세로로 아래로 내려오는 구조
- [ ] **목표**: 가로로 배치된 네비게이션 메뉴로 변경
- [ ] **구현 방안**: 
  ```
  0. 홈 | 1. 캐릭터 검색 | 2. 던전 클리어 현황 | 3. 파티구성
  ```
- [ ] **기술적 요구사항**:
  - 세로 메뉴를 가로 메뉴로 변경
  - 각 메뉴 항목을 확실한 구분처리 
  - 현재 활성화된 메뉴 항목 시각적 강조
  - 반응형으로 작은 화면에서도 가독성 유지

### 2. 모험단 검색 영역 UI 개선
- [ ] **현재 문제**: 검색된 모험단 목록이 검색 버튼을 침범
- [ ] **해결 방안**: 
  - 검색 결과 드롭다운의 위치 및 크기 조정
  - 검색 버튼과 겹치지 않도록 z-index 및 위치 조정
- [ ] **추가 요구사항**: 
  - 큰 화면에서도 모험단 검색이 작은 구간만 차지하고 커지지않음 
  - 검색 영역의 너비를 적절하게 확장하여 다른 UI 요소와 균형 맞추기

### 3. 기본 규칙 섹션 반응형 레이아웃
- [ ] **현재 상태**: 작은 화면에서 기본 규칙이 버튼 위에 한 줄로 표시
- [ ] **목표**: 작은 화면에서도 기본 규칙이 적절한 공간을 차지하도록 개선
- [ ] **구현 방안**:
  - 작은 화면에서 기본 규칙 섹션의 너비를 전체 너비로 확장
  - 버튼들과의 간격 및 배치 최적화
  - 텍스트 가독성 향상을 위한 여백 및 크기 조정

### 4. 파티 헤더 정보 한 줄 배치
- [ ] **현재 상태**: 파티 정보가 여러 줄로 나뉘어 표시
- [ ] **목표**: 파티 정보를 한 줄에 깔끔하게 표시
- [ ] **구현 방안**:
  ```
  파티 1 | 총 전투력: 164.8억 | 버프력: 405만 | 파티 계수: 667.98
  ```
- [ ] **기술적 요구사항**:
  - `flexbox` 또는 `grid`를 사용하여 한 줄 배치
  - 각 정보 항목 간 적절한 구분처리
  - 화면 크기에 따라 자동으로 글자 크기 변경 
  - 정보 밀도가 높아도 가독성 유지

### 5. 모험단 정보 섹션 3단 분할 및 반응형 개선
- [ ] **현재 상태**: 
  - 모험단명, 딜러 개수, 버퍼 개수가 한 줄에 표시
  - 딜러/버퍼 탭이 붙어있음
  - 캐릭터 카드들이 겹치는 문제 발생
- [ ] **목표**: 
  - 모험단 정보를 3개 구간으로 명확하게 분할
  - 작은 화면에서 파티 구성의 캐릭터처럼 세로 배치
- [ ] **구현 방안**:

#### **5-1. 모험단 정보 3단 분할**
```
[모험단명] [딜러: X명] [버퍼: X명]
```
- 각 구간이 동일한 너비를 차지하도록 `grid-template-columns: 1fr 1fr 1fr` 적용
- 구간 간 적절한 구분선 또는 여백 추가

#### **5-2. 딜러/버퍼 탭 분리**
- **큰 화면**: 딜러/버퍼 탭을 좌우로 나란히 배치
- **작은 화면**: 딜러/버퍼 탭을 세로로 층을 구성하여 배치
- 탭 간격 및 크기 최적화

#### **5-3. 캐릭터 카드 겹침 문제 해결**
- **큰 화면**: 기존 그리드 레이아웃 유지
- **작은 화면**: 
  - 딜러와 버퍼를 별도 섹션으로 분리
  - 각 섹션을 세로로 층을 구성하여 배치
  - 캐릭터 카드들이 겹치지 않도록 적절한 여백 설정

### 6. 반응형 브레이크포인트 세분화
- [ ] **현재 상태**: 1200px, 768px, 480px 기준으로 반응형 처리
- [ ] **추가 필요**: 
  - 1400px 이상: 데스크톱 최적화
  - 1200px - 1400px: 태블릿 가로 모드
  - 768px - 1200px: 태블릿 세로 모드
  - 480px - 768px: 모바일 가로 모드
  - 480px 이하: 모바일 세로 모드

### 7. 우선순위 및 구현 계획
1. **1순위**: 모험단 검색 UI 개선 (사용성 향상)
2. **2순위**: 파티 헤더 정보 한 줄 배치 (가독성 향상)
3. **3순위**: 모험단 정보 3단 분할 (구조 개선)
4. **4순위**: 기본 규칙 섹션 반응형 (레이아웃 최적화)
5. **5순위**: 전역 네비게이션 메뉴 (전체적인 UX 개선)
6. **6순위**: 딜러/버퍼 탭 반응형 (모바일 최적화)

### 8. 테스트 및 검증 계획
- [ ] **브라우저 테스트**: Chrome, Firefox, Safari, Edge
- [ ] **화면 크기 테스트**: 1920x1080, 1366x768, 1024x768, 768x1024, 375x667
- [ ] **사용성 테스트**: 실제 사용자 피드백 수집
- [ ] **성능 테스트**: 반응형 전환 시 애니메이션 부드러움 확인

## 🚀 **프론트엔드 필터링 로직 백엔드 이전 작업 (2025-08-22)**

### 1. 현재 문제점
- [ ] **프론트엔드에서 복잡한 필터링**: 명성컷, 딜컷, 클리어여부 등을 프론트엔드에서 처리
- [ ] **성능 저하**: 모든 캐릭터 데이터를 프론트엔드로 전송 후 필터링
- [ ] **코드 중복**: 각 페이지마다 동일한 필터링 로직 반복
- [ ] **유지보수 어려움**: 필터링 조건 변경 시 여러 파일 수정 필요

### 2. 백엔드 이전 대상 기능
- [ ] **명성 체크**: 베누스(41,929), 안개신(30,135), 나벨(47,684), 황혼전(72,688)
- [ ] **딜러/버퍼 구분**: `totalDamage > 0` vs `buffPower > 0`
- [ ] **던전 클리어 여부**: 각 던전별 클리어 상태 체크
- [ ] **안감 제외**: `isExcluded` 필드 체크
- [ ] **나벨 일반/하드 구분**: `isNormalNabelEligible`, `isHardNabelEligible`

### 3. 백엔드 API 개선 계획
- [ ] **새로운 엔드포인트 추가**: `/characters/filtered` - 필터링된 캐릭터만 반환
- [ ] **쿼리 파라미터 지원**: 
  - `dungeon`: 던전 타입 (nabel-normal, nabel-hard, venus, fog, twilight)
  - `adventure`: 모험단명
  - `includeCleared`: 클리어한 캐릭터 포함 여부 (기본값: false)
- [ ] **응답 데이터 최적화**: 필요한 필드만 선택적으로 반환

### 4. 프론트엔드 수정 계획
- [ ] **CharacterSearch.vue**: 백엔드 필터링 API 사용하도록 수정
- [ ] **DungeonStatus.vue**: 백엔드 필터링 API 사용하도록 수정
- [ ] **PartyFormation.vue**: 백엔드 필터링 API 사용하도록 수정
- [ ] **공통 유틸리티 함수 제거**: 각 페이지의 중복된 필터링 로직 제거

### 5. 구현 우선순위
1. **1순위**: 백엔드 필터링 API 구현 (`/characters/filtered`)
2. **2순위**: CharacterSearch.vue 백엔드 API 사용으로 수정
3. **3순위**: DungeonStatus.vue 백엔드 API 사용으로 수정
4. **4순위**: PartyFormation.vue 백엔드 API 사용으로 수정
5. **5순위**: 중복 코드 정리 및 테스트

### 6. 기대 효과
- [ ] **성능 향상**: 불필요한 데이터 전송 제거
- [ ] **코드 품질 향상**: 중복 코드 제거, 단일 책임 원칙 준수
- [ ] **유지보수성 향상**: 필터링 로직 중앙화
- [ ] **확장성 향상**: 새로운 필터링 조건 추가 용이 